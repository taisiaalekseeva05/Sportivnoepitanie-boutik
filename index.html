<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
    <h1>Спортивное питание</h1>
    <div class="product-gallery">
        <div class="product-el">
            <h4>Product 1</h4>
            <img src="https://avatars.mds.yandex.net/get-altay/4234257/2a00000179487450016b940fced1ba953a30/XXL" alt="">
            <h6>400 р.</h6>
            <div class="configurate-count">
                <div class="btn-minus">-</div>
                <input type="text" class="input-count" value="0">
                <div class="btn-plus">+</div>
            </div>
            <div class="btn add-to-cart">Добавить в корзину</div>
        </div>

        <div class="product-el">
            <h4>Product 2</h4>
            <img src="https://avatars.mds.yandex.net/get-altay/4398559/2a000001794873ec242980b0fa7b544fbc29/XXL" alt="">
            <h6>700 р.</h6>
            <div class="configurate-count">
                <div class="btn-minus">-</div>
                <input type="text" class="input-count" value="0">
                <div class="btn-plus">+</div>
            </div>
            <div class="btn add-to-cart">Добавить в корзину</div>
        </div>

        <div class="product-el">
            <h4>Product 3</h4>
            <img src="https://irecommend.ru/sites/default/files/product-images/399872/xNCh5bUETlpQaKMV7HNMA.jpg" alt="">
            <h6>500 р.</h6>
            <div class="configurate-count">
                <div class="btn-minus">-</div>
                <input type="text" class="input-count" value="0">
                <div class="btn-plus">+</div>
            </div>
            <div class="btn add-to-cart">Добавить в корзину</div>
        </div>

        <div class="product-el">
            <h4>Product 4</h4>
            <img src="https://irecommend.ru/sites/default/files/product-images/1520372/WyUyevA8P449RlzdG09Rmg.jpg" alt="">
            <h6>400 р.</h6>
            <div class="configurate-counter">
                <div class="btn-minus" data-action="minus">-</div>
                <div class="input-count" data-counter>0</div>
                <!-- <input type="text" class="input-count" value="0"> -->
                <div class="btn-plus" data-action="plus">+</div>
            </div>
            <!-- <div class="configurate-count">
                <div class="btn-minus">-</div>
                <input type="text" class="input-count" value="0">
                <div class="btn-plus">+</div>
            </div> -->
            <div class="btn add-to-cart">Добавить в корзину</div>
            <!-- <div class="btn add-to-cart"> -->

        </div>
    </div>
    </div>

    <h1>Корзина</h1>
    <div class="preview-cart">
        <h2>У вас в корзине <b id="prev-count">0</b> товаров на сумму <b id="prev-price">0</b> рублей</h2>
        <div class="btn">Перейти к оформлению заказа</div>
    </div>
</body>

</html>

<script>
    let cartObj = {}

    $(document).on("click", ".add-to-cart", function() {
        let nowItemName = $(this).parent().children("h4").text()
        let nowItemPrice = $(this).parent().children("h6").text()

        nowItemPrice = nowItemPrice.replace(" р.", "")
        nowItemPrice = Number(nowItemPrice)

        if (cartObj[nowItemName] == undefined) {
            cartObj[nowItemName] = {
                name: nowItemName,
                price: nowItemPrice,
                count: 1
            }
        } else {
            cartObj[nowItemName]["count"] += 1
        }

        console.log(cartObj)

        let countNow = 0
        let sumPriceNow = 0

        $.each(cartObj, function(indexInArray, valueOfElement) {
            countNow += valueOfElement["count"]

            sumPriceNow += (valueOfElement["count"] * valueOfElement["price"])
        });

        $("#prev-count").text(countNow)
        $("#prev-price").text(sumPriceNow)

    });

    window.addEventListener('click', function (event) {
        let counter;
        if (event.target.dataset.action === 'plus' || event.target.dataset.action === 'minus') {
           const configurateCounter = event.target.closest('.configurate-counter');
           counter = configurateCounter.querySelector('[data-counter]');
        }
        if (event.target.dataset.action === 'plus') {
           counter.innerText = ++counter.innerText;
        }
        if (event.target.dataset.action === 'minus') {
            if (parseInt(counter.innerText) > 1) {
               counter.innerText = --counter.innerText;
            } 
        }
    });        

    // $(document).on("click", ".btn-plus", function() {

    // });
</script>